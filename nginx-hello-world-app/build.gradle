/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/8.0/samples
 */
plugins {
    id 'java'
    id 'org.eclipse.jkube.kubernetes' version '1.10.1'
}

// Import task types
import com.bmuschko.gradle.docker.tasks.container.*
import com.bmuschko.gradle.docker.tasks.image.*


kubernetes {
  images {
    image{
        name = 'gradle-nginx-hello-workld:latest'
    }   
  }
}

def stage(String stageName, Closure closure) {
    println "Executing stage: $stageName"
    closure()
}

// Define the pipeline stages
def pipeline = {
  // Stage 1: Clean the project
  stage('Clean') {
    sh 'gradle clean'
  }
  
  // Stage 2: Build the project
  stage('Build') {
    sh 'gradle build'
  }
  
  
  // Stage 3: Build and publish the Docker image
  stage('Build and Publish Docker Image') {
      sh "docker build -t ${project_name} ."
      sh "docker tag ${project_name} ${project_name}:latest"
  }
}

// Define the pipeline steps
pipeline {
  
  environment {
    project_name = 'gradle-nginx-hello-workld'
  }
    
    // Run the pipeline stages
    pipeline()
  }
}
